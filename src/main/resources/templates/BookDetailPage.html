<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title th:text="${book != null ? book.title : '책 정보 없음'}">책 제목</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <link href="/assets/css/newSidebar.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Jua', 'Arial Rounded MT Bold', Arial, sans-serif;
      background-color: #fff9e6;
    }

    /* 모달 관련 추가 스타일 */
    .modal-content {
      background-color: #fffbeb;
      border-radius: 1.5rem;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }

    .modal-header, .modal-footer {
      border-color: #fef3c7;
    }

    .modal-title {
      color: #92400e;
      font-size: 1.5rem;
      font-weight: 700;
    }

    .modal-body p {
      color: #b45309;
      font-size: 1.125rem;
    }

    .btn {
      border-radius: 9999px;
      padding: 0.75rem 1.5rem;
      font-weight: 700;
      transition: all 0.3s ease;
    }

    #yesButton {
      background-color: #10b981;
      color: white;
    }

    #yesButton:hover {
      background-color: #059669;
    }

    #noButton {
      background-color: #ef4444;
      color: white;
    }

    #noButton:hover {
      background-color: #dc2626;
    }

    .close {
      cursor: pointer;
    }
  </style>
</head>
<body>
<!-- Navigation Bar -->
<nav class="navbar navbar-expand-lg">
  <div class="container-fluid">
    <span id="toggleSidebar" class="navbar-toggler-icon"></span>
    <div class="navbar-collapse justify-content-end">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="/"><i class="fas fa-home"></i> 메인페이지</a>
        </li>
        <li class="nav-item" th:if="${user == null}">
          <a class="nav-link" href="/login"><i class="fas fa-sign-in-alt"></i> 로그인</a>
        </li>
        <li class="nav-item" th:if="${user == null}">
          <a class="nav-link" href="/signup"><i class="fas fa-user-plus"></i> 회원가입</a>
        </li>
        <li class="nav-item" th:if="${user != null}">
          <a class="nav-link" th:text="${user.name + '님'}"><i class="fas fa-user-plus"></i></a>
        </li>
        <li class="nav-item" th:if="${user != null}">
          <a class="nav-link" href="/logout"><i class="fas fa-sign-out-alt"></i> 로그아웃</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div id="sidebar">
  <a href="/children/select"><i class="fas fa-child"></i> 아이 프로필 변경</a>
  <a href="/children/page"><i class="fas fa-edit"></i> 아이 정보 수정</a>
  <a href="/userpage"><i class="fas fa-user"></i> 계정보기</a>
  <a href="/children/childMBTIResult"><i class="fas fa-user-circle"></i> 아이 성향 확인하기</a>
  <a href="/ChildRecentReadBook"><i class="fas fa-history"></i> 최근 책 보기</a>
  <a href="/ChildFavorBookList"><i class="fas fa-heart"></i> 좋아요 누른 책 보기</a>
  <a href="/BookCategoryHtml"><i class="fas fa-tags"></i> 카테고리 별 책보기</a>
  <a href="/lottery/form"><i class="fas fa-gift"></i> 선착순 이벤트</a>
</div>

<!-- Original Content -->
<div class="min-h-screen flex items-center justify-center p-4 mt-8">
  <div th:if="${book == null}" class="text-center">
    <h1 class="text-3xl font-bold mb-4 text-yellow-800">책 정보를 불러올 수 없습니다.</h1>
    <p class="text-xl text-yellow-700">잠시 후 다시 시도해 주세요.</p>
  </div>
  <div th:if="${book != null}" class="w-full max-w-6xl mx-auto bg-white rounded-3xl shadow-2xl overflow-hidden">
    <div class="md:flex">
      <div class="md:w-1/3 p-8 flex justify-center items-start bg-yellow-50">
        <img th:src="@{/book/image/{bookId}(bookId=${book.bookId})}"
             alt="책 표지"
             class="rounded-2xl shadow-lg transition-all duration-300 hover:scale-105"
             width="300" height="400">
        <div th:if="${book.bookImage == null}" class="w-[300px] h-[400px] bg-yellow-200 flex items-center justify-center rounded-2xl shadow-lg">
        </div>
      </div>
      <div class="md:w-2/3 p-8 flex flex-col justify-between">
        <div>
          <h1 th:text="${book.title}" class="text-4xl font-bold mb-4 text-yellow-800">책 제목</h1>
          <p th:text="${book.summary}" class="mb-8 text-lg text-yellow-700 leading-relaxed">책 설명</p>
        </div>
        <div>
          <div class="flex flex-wrap gap-3 mb-8">
            <span class="category-label" th:text="${book.category}">카테고리</span>
            <span class="category-label" th:if="${book.recommendedAge != null}" th:text="${book.recommendedAge}">연령</span>
            <span class="mbti-label" th:if="${book.bookMbti != null and book.bookMbti.eiType != 0}" th:text="${book.bookMbti.eiType > 0 ? 'E성향' : 'I성향'}"></span>
            <span class="mbti-label" th:if="${book.bookMbti != null and book.bookMbti.snType != 0}" th:text="${book.bookMbti.snType > 0 ? 'S성향' : 'N성향'}"></span>
            <span class="mbti-label" th:if="${book.bookMbti != null and book.bookMbti.tfType != 0}" th:text="${book.bookMbti.tfType > 0 ? 'T성향' : 'F성향'}"></span>
            <span class="mbti-label" th:if="${book.bookMbti != null and book.bookMbti.jpType != 0}" th:text="${book.bookMbti.jpType > 0 ? 'J성향' : 'P성향'}"></span>
          </div>
          <div class="flex justify-between items-center mb-8">
            <div class="flex space-x-4">
              <form th:action="${book.liked ? '/DelBookLike' : '/BookLike'}" method="get">
                <input type="hidden" name="bookId" th:value="${book.bookId}">
                <input type="hidden" name="type" id="type1">
                <button type="submit" class="btn btn-outline flex items-center justify-center" th:classappend="${book.liked ? 'text-blue-500' : ''}">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5" />
                  </svg>
                  좋아요
                </button>
              </form>
              <form th:action="${book.disliked ? '/DelBookDisLike' : '/BookDisLike'}" method="get">
                <input type="hidden" name="bookId" th:value="${book.bookId}">
                <input type="hidden" name="childId" th:value="${childId}">
                <input type="hidden" name="type" id="type2">
                <button type="submit" class="btn btn-outline flex items-center justify-center" th:classappend="${book.disliked ? 'text-red-500' : ''}">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14H5.236a2 2 0 01-1.789-2.894l3.5-7A2 2 0 018.736 3h4.018a2 2 0 01.485.06l3.76.94m-7 10v5a2 2 0 002 2h.096c.5 0 .905-.405.905-.904 0-.715.211-1.413.608-2.008L17 13V4m-7 10h2m5-10h2a2 2 0 012 2v6a2 2 0 01-2 2h-2.5" />
                  </svg>
                  싫어요
                </button>
              </form>
            </div>
          </div>
          <a th:href="@{/read}" class="btn bg-yellow-400 hover:bg-yellow-500 text-yellow-800 font-bold w-full block text-center text-2xl">책읽기</a>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="myModal" tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content bg-yellow-50 rounded-3xl shadow-2xl">
      <div class="modal-header border-b border-yellow-200">
        <h5 class="modal-title text-2xl font-bold text-yellow-800" id="myModalLabel">추천은 어땠나요?</h5>
        <button type="button" class="close text-yellow-800 text-3xl font-bold" aria-label="Close" onclick="$('#myModal').modal('hide')">
          <span aria-hidden="true">&times;</span>
        </button>

        </button>
      </div>
      <div class="modal-body text-center p-6">
        <p class="text-lg text-yellow-700">추천 내용을 마음에 드셨나요? 아래 버튼 중 하나를 선택해주세요.</p>
      </div>
      <div class="modal-footer border-t border-yellow-200 justify-center">
        <button type="button" class="btn bg-green-500 hover:bg-green-600 text-white" id="yesButton">좋아요</button>
        <button type="button" class="btn bg-red-500 hover:bg-red-600 text-white" data-dismiss="modal" id="noButton">별로에요</button>
      </div>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script src="/assets/js/newSidebar.js"></script>
<script>
  const IsCategory = sessionStorage.getItem("IsCategory");
  const category =sessionStorage.getItem("category");
  console.log(IsCategory);
  const selectedChildId = sessionStorage.getItem("selectedChildId");
  const type = sessionStorage.getItem("Type");
  document.getElementById("type2").value = type;
  document.getElementById("type1").value = type;
  if (IsCategory === "1") {
    setTimeout(() => {
      $('#myModal').modal('show');
    }, 5000);
  }
  document.addEventListener("DOMContentLoaded", function() {
    const yesButton = document.getElementById("yesButton");
    const noButton = document.getElementById("noButton");
    yesButton.addEventListener("click", function() {
      BookCategoryLike(selectedChildId,category);
      $('#myModal').modal('hide');
    });

    noButton.addEventListener("click", function() {
      BookCategoryDisLike(selectedChildId,category);
      $('#myModal').modal('hide');
    });
  });
  document.addEventListener('DOMContentLoaded', function() {
    const closeModalBtn = document.getElementById('closeModalBtn');
    const modal = document.getElementById('myModal');

    if (closeModalBtn && modal) {
      closeModalBtn.addEventListener('click', function() {
        $('#myModal').modal('hide');
      });
    }
  });
  function BookCategoryLike(childId, category) {
    console.log(category);
    $.get(`/Book/CategoryLike?childId=${childId}&Ctegory=${category}`, function(response) {
      console.log("좋아요 응답:", response);
    }).fail(function() {
      console.error("좋아요 호출 실패");
    });
  }

  function BookCategoryDisLike(childId, category) {
    console.log(category);
    $.get(`/Book/CategoryDisLike?childId=${childId}&Ctegory=${category}`, function(response) {
      console.log("싫어요 응답:", response);
    }).fail(function() {
      console.error("싫어요 호출 실패");
    });
  }

</script>
</body>
</html>